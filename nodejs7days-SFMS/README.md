# 七天学会NodeJS 大示例总结

学习资料来源[七天学会NodeJS](http://nqdeng.github.io/7-days-nodejs/#5.1)。

## 功能 ##
开发的是一个简单的**静态文件合并服务器(static files merge server,SFMS)**。

该服务器支持类似以下格式的JS或CSS文件合并请求：
`http://assets.example.com/foo/??bar.js,baz.js`
在以上URL中，`??`是一个分隔符，之前是需要合并的多个文件的URL的公共部分，之后是使用`,`分隔的差异部分。因此服务器处理这个URL时，返回的是以下两个文件按顺序合并后的内容。

    /foo/bar.js
    /foo/baz.js
另外，服务器也能支持类似以下格式的普通的JS或CSS文件请求。
`http://assets.example.com/foo/bar.js`

## 开发方式 ##
使用快速迭代的开发方式，在第一次迭代时先实现服务器的基本功能。

服务器处理一次请求的流程：

               +---------+   +-----------+   +----------+
    request -->|  parse  |-->|  combine  |-->|  output  |--> response
               +---------+   +-----------+   +----------+
首先，服务器分析请求的URL，得到请求的文件路径和类型（MIME）。然后，服务器会读取请求的文件，并按顺序合并文件内容。最后，服务器返回响应，完成对一次请求的处理。

另外，服务器在读取文件时有个根目录，并且服务器监听的HTTP端口没有写死在代码里，因此服务器是可配置的。

## 稳定性 ##
利用NodeJS的进程管理机制，将守护进程作为父进程，将服务器程序作为子进程，并让父进程监控子进程的运行状态，在其异常退出时重启子进程。

可以通过`node daemon.js config.json`启动服务。



